最简单的驱动结构
- 头文件 `module.h`和`init.h`
- 驱动加载函数
- 驱动卸载函数
- 许可证声明
- 模块参数
- 作者与版本信息
# helloworld！
```c
//头文件
#include <linux/module>
#include <linux/init>
static int helloworld_init(void)
{
    printk("helloworld!");
    return 0;    
}
static void helloworld_exit(void)
{
    printk("goobyeworld")
}
// 加载与卸载函数
module_init(helloworld_init);
module_exit(helloworld_exit);
// 协议
MODULE_LICENSE("GPL");
```
## 如何编译驱动程序
- 将编译程序编译进内核
- 将驱动程序编译成驱动模块.ko
# 编译成驱动模块
先写Makefile
```c
obj-m += helloworld.o
KDIR:=/home/alientek/ATOMPI--CA1/ATOMPI-CA1_SDK_v1.2/kernel
PWD?=$(shell pwd)
all:
		make -C $(KDIR) M=$(PWD) modules
clean:
		rm -f *.ko *.o *.mod.o *.mod.c *.symvers *.order_
```
**然后设置环境变量**
`export ARCH=arm64`
`export CROSS_COMPILE=/home/alientek/ATOMPI--CA1/ATOMPI-CA1_SDK_v1.2/prebuilts/gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-rockchip1031-linux-gnu-`
**输入make**


# 遇到的问题&处理方法
1.在正点原子官方的sdk里面有两套编译器，我们使用的是rockchip修改之后的
2.代码编译报错
驱动卸载函数没有返回值 `犯蠢了，直接复制的加载函数，返回值成int了`
3.**make的时候找不到编译器**
虽然设置了环境变量，但是系统的PATH变量里没有编译器
应该在设置环境变量之后`export PATH=$PATH:/home/alientek/ATOMPI--CA1/ATOMPI-CA1_SDK_v1.2/prebuilts/gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin`
这里我把这三行export命令写到bashrc末尾了，不用每次都输一遍了
==tmd刚反应过来，又犯蠢了，这样会影响以后搞其他开发板，明天再改吧==
4.make之前，要先编译一遍内核
**3.的新解决方案**，写一个env_rockchip.sh 里面包含上面的三个export
bashrc里面最后加上alias loadrk3568="~/env_rockchip.sh"
以后新开一个终端，只需要输入loadrk3568就行